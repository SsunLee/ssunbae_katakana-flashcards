"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5212],{5328:(e,t,r)=>{r.d(t,{G:()=>n,N:()=>l});let s=r(5125).A.create({baseURL:"https://ssunbae-api.vercel.app",timeout:15e3});async function l(){try{let e=await s.get("/api/verbs");if(e.data&&Array.isArray(e.data.verbs))return e.data.verbs;throw Error("Invalid API response structure")}catch(e){throw console.error("Failed to fetch verbs: ".concat(e.message)),e}}async function n(){try{return(await s.get("/api/kanji")).data}catch(e){throw console.error("Failed to fetch kanji: ".concat(e.message)),e}}},8873:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(2115),l=r(9708),n=r(5190),a=r(8720);function o(e){let{user:t,deckType:r,fetchData:o,fallbackData:i}=e,[c,u]=(0,s.useState)([]),[d,f]=(0,s.useState)({}),[h,x]=(0,s.useState)(!0),[g,m]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{x(!0),m(null);let e=o().catch(e=>(console.error("API fetch failed, falling back to local data.",e),a.oR.warning("서버에 연결할 수 없어 기본 데이터로 시작합니다."),i)),s=(async()=>{if(!t)return{};try{let e=(0,l.H9)(n.db,"users",t.uid,"favorites",r),s=await (0,l.x7)(e);if(s.exists()){let e=s.data(),t={};return e.ids&&Array.isArray(e.ids)&&e.ids.forEach(e=>{t[e]=!0}),t}return{}}catch(e){return console.error("Failed to fetch favorites:",e),a.oR.error("즐겨찾기 정보를 가져오는 데 실패했습니다."),{}}})();try{let[t,r]=await Promise.all([e,s]);t&&t.length>0?u(t):(u(i),console.error("Both API and fallback data failed or are empty."),a.oR.error("학습 데이터를 불러오는 데 실패했습니다.")),f(r)}catch(e){console.error("An unexpected error occurred during data loading:",e),m("데이터를 불러오는 중 예상치 못한 오류가 발생했습니다.")}finally{x(!1)}})()},[t,r,o,i]);let y=(0,s.useCallback)(async e=>{if(console.log("--- [Debug] toggleFav 시작 ---"),console.log("전달받은 id:",e,"| 타입:",typeof e),!t){a.oR.error("즐겨찾기 기능은 로그인이 필요합니다."),console.log("[Debug] 사용자 정보(user)가 없어 함수를 종료합니다.");return}console.log("[Debug] 현재 사용자:",t);let s=Number(e);if(isNaN(s)){a.oR.error("잘못된 카드 ID입니다."),console.error("[Debug] id를 숫자로 변환할 수 없습니다:",e);return}let o=(0,l.H9)(n.db,"users",t.uid,"favorites",r);console.log("[Debug] Firestore 경로:",o.path);let i={...d};try{i[s]?(console.log("[Debug] 즐겨찾기 해제 시도: id=".concat(s)),delete i[s],await (0,l.mZ)(o,{ids:(0,l.C3)(s)}),a.oR.info("즐겨찾기에서 해제했습니다.")):(console.log("[Debug] 즐겨찾기 추가 시도: id=".concat(s)),i[s]=!0,await (0,l.BN)(o,{ids:(0,l.hq)(s)},{merge:!0}),a.oR.success("즐겨찾기에 추가했습니다!")),f(i),console.log("[Debug] 로컬 즐겨찾기 상태 업데이트 완료:",i)}catch(e){console.error("Firestore 업데이트 실패:",e),a.oR.error("즐겨찾기 업데이트에 실패했습니다.")}finally{console.log("--- [Debug] toggleFav 종료 ---")}},[t,r,d]);return{deck:c,favs:d,toggleFav:y,shuffleDeck:(0,s.useCallback)(()=>{u(e=>[...e].sort(()=>Math.random()-.5)),a.oR.info("카드를 섞었습니다.")},[]),resetDeckToInitial:(0,s.useCallback)(()=>{u(i),f({}),a.oR.info("학습 덱을 초기 상태로 되돌렸습니다.")},[i]),isLoading:h,error:g}}},9437:(e,t,r)=>{r.d(t,{A:()=>c});var s=r(5155),l=r(2115),n=r(2171),a=r(8456),o=r(5917);let i=e=>{if(!e)return null;let t=e.match(/[a-zA-Z][^a-zA-Z]*/g);if(!t)return null;let r={x:0,y:0},s=null;for(let e=0;e<t.length;e++){let l=t[e],n=l[0],a=(l.slice(1).match(/-?[\d.]+/g)||[]).map(parseFloat);if(a.some(isNaN))continue;let o=n===n.toLowerCase(),i=n.toUpperCase();if(0===e&&"M"===i){s={...r={x:a[0],y:a[1]}};for(let e=2;e<a.length;e+=2)o?(r.x+=a[e],r.y+=a[e+1]):(r.x=a[e],r.y=a[e+1])}else{let e=0;if("C"===i)e=6;else if("L"===i||"T"===i)e=2;else if("H"===i||"V"===i)e=1;else if("S"===i||"Q"===i)e=4;else if("A"===i)e=7;else if("Z"===i)continue;for(let t=0;t<a.length;t+=e){let s=a.slice(t,t+e),l=r.x,n=r.y;"H"===i?l=o?l+s[0]:s[0]:"V"===i?n=o?n+s[0]:s[0]:e>0&&(l=o?l+s[e-2]:s[e-2],n=o?n+s[e-1]:s[e-1]),r={x:l,y:n}}}}return s?{start:s,end:r}:null};function c(e){var t,r;let{kanji:c,onClose:u,onNext:d,onPrev:f,onShuffle:h,onReset:x}=e,[g,m]=(0,l.useState)(!0),[y,j]=(0,l.useState)([]),[p,k]=(0,l.useState)(0),[v,b]=(0,l.useState)(!0),[w,N]=(0,l.useState)(null),[S,A]=(0,l.useState)(!1),[C,D]=(0,l.useState)(""),[L,M]=(0,l.useState)(0),[R,z]=(0,l.useState)([]),F=(0,l.useRef)(null);(0,l.useEffect)(()=>{(async()=>{if(b(!0),N(null),M(0),z([]),j([]),k(0),!c){N("한자 정보가 없습니다."),b(!1);return}let e=c.trim()[0].charCodeAt(0).toString(16).padStart(5,"0");try{let t=await fetch("https://raw.githubusercontent.com/KanjiVG/kanjivg/master/kanji/".concat(e,".svg"));if(!t.ok)throw Error("HTTP ".concat(t.status));let r=await t.text(),s=new DOMParser().parseFromString(r,"image/svg+xml"),l=Array.from(s.querySelectorAll("path")).map(e=>e.getAttribute("d")||"");j(l),k(l.length)}catch(e){console.error("Failed to fetch KanjiVG data:",e),N("획순 데이터를 가져올 수 없습니다.")}finally{b(!1)}})()},[c]);let E=e=>{let t=F.current;if(!t)return null;let r="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY,l=t.createSVGPoint();l.x=r,l.y=s;let n=t.getScreenCTM();if(n){let e=n.inverse();return l.matrixTransform(e)}return null},T=!v&&L>=p&&p>0,P=e=>{if(e.preventDefault(),T||v||!y[L])return;let t=E(e);if(!t)return;let r=i(y[L]);r&&20>Math.hypot(t.x-r.start.x,t.y-r.start.y)&&(A(!0),D("M ".concat(t.x," ").concat(t.y)))},$=e=>{if(e.preventDefault(),!S)return;let t=E(e);t&&D(e=>"".concat(e," L ").concat(t.x," ").concat(t.y))},I=()=>{if(!S)return;if(A(!1),!y[L]||!C)return void D("");let e=i(y[L]),t=i(C);e&&t&&20>Math.hypot(t.end.x-e.end.x,t.end.y-e.end.y)&&(z(e=>[...e,L]),M(e=>e+1)),D("")};return(0,s.jsxs)("div",{className:"w-full h-full flex flex-col items-center gap-2 p-4 bg-card/95 rounded-lg",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium",children:["한자 쓰기: ",c]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>m(!g),className:(0,a.cn)("transition-colors",g?"bg-primary/10":""),children:g?"힌트 끄기":"힌트 보기"}),(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:u,children:"닫기"})]})]}),(0,s.jsx)("main",{className:"relative w-full aspect-square max-w-md border-2 border-border rounded-lg bg-background touch-none",children:(0,s.jsxs)("svg",{ref:F,className:"absolute inset-0 w-full h-full",viewBox:"0 0 ".concat(109," ").concat(109),onMouseDown:P,onMouseMove:$,onMouseUp:I,onMouseLeave:I,onTouchStart:P,onTouchMove:$,onTouchEnd:I,children:[(0,s.jsx)("defs",{children:(0,s.jsxs)("g",{id:"grid-lines",style:{stroke:"#e2e8f0",strokeWidth:"0.5"},children:[(0,s.jsx)("line",{x1:54.5,y1:"0",x2:54.5,y2:109}),(0,s.jsx)("line",{x1:"0",y1:54.5,x2:109,y2:54.5}),(0,s.jsx)("line",{x1:"0",y1:"0",x2:109,y2:109,style:{strokeDasharray:"2 2"}}),(0,s.jsx)("line",{x1:109,y1:"0",x2:"0",y2:109,style:{strokeDasharray:"2 2"}})]})}),(0,s.jsx)("use",{href:"#grid-lines"}),g&&(0,s.jsx)("g",{style:{stroke:"#cbd5e1",opacity:.7,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"},children:y.map((e,t)=>(0,s.jsx)("path",{d:e},"bg-".concat(t)))}),(0,s.jsx)("g",{style:{stroke:"#475569",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"},children:R.map(e=>(0,s.jsx)("path",{d:y[e]},"drawn-".concat(e)))}),g&&!T&&y[L]&&(0,s.jsxs)("g",{children:[(0,s.jsx)("path",{d:y[L],stroke:"#2563eb",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round",fill:"none",style:{opacity:.4}}),(0,s.jsx)("circle",{cx:null==(t=i(y[L]))?void 0:t.start.x,cy:null==(r=i(y[L]))?void 0:r.start.y,r:"3",fill:"#2563eb"})]}),C&&(0,s.jsx)("path",{d:C,style:{stroke:"black",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}}),v&&(0,s.jsx)("text",{x:"50%",y:"50%",textAnchor:"middle",dy:".3em",children:"로딩 중..."}),w&&(0,s.jsx)("text",{x:"50%",y:"50%",textAnchor:"middle",dy:".3em",fill:"red",children:w}),T&&(0,s.jsxs)("g",{className:"pointer-events-none",children:[(0,s.jsx)("rect",{width:"100%",height:"100%",fill:"rgba(255, 255, 255, 0.8)",className:"animate-in fade-in duration-500"}),(0,s.jsx)("foreignObject",{x:"0",y:"0",width:"100%",height:"100%",children:(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)(o.A,{className:"w-16 h-16 text-green-500 animate-in fade-in zoom-in-50 duration-700"})})})]})]})}),(0,s.jsxs)("footer",{className:"flex flex-col items-center justify-center w-full mt-2 gap-2",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-2 w-full max-w-xs",children:[(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:f,children:"이전"}),(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:d,children:"다음"}),(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:h,children:"섞기"}),(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:x,children:"리셋"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between w-full max-w-xs",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[L," / ",p," 획"]}),(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>{z([]),M(0)},className:"text-destructive",children:"지우기"})]})]})]})}}}]);